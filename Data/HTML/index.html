<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>MNBikeways</title>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
     <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

    <script src="static/ui-bootstrap-tpls-0.12.1.min.js"></script>
    <script src="static/angular-leaflet-directive.min.js"></script>

    <style>
        [ng-click] {cursor:pointer}
    </style>


    <script>
        angular.module('SearchAndRouteModule',['ui.bootstrap','leaflet-directive']).controller('SearchAndRouteController',function($scope,$http,leafletData){
            $scope.getLocation =function(val) {
    return $http.get('http://localhost:8000/searchAjax/', {
      params: {
        q: val
      }
    }).then(function(response){
      return response.data;

    });
  };

            $scope.fromToArray = new Array();
            $scope.fromToArray.push("From: ");
            $scope.fromToArray.push("To: ");

            $scope.Selected = new Array();

            $scope.onSelect = function($item,$model,$label){
                if($scope.Selected.length!=2) {
                    $scope.Selected.push($item);
                }
            }

            $scope.rearrange = function(){
                    var tmp = $scope.Selected[0];
                    $scope.Selected[0]=$scope.Selected[$scope.Selected.length-1];
                    $scope.Selected[$scope.Selected.length-1]=tmp;

            }
            function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        }}

            var lat=undefined;
            var lng=undefined;

            function showPosition(position) {

                lat = position.coords.latitude;
                lng = position.coords.longitude;
                leafletData.getMap().then(function (map) {
                    var data = $http.get('http://localhost:8000/geoJson/', {params: {lat1: lat,lng1:lng}}).then(function (response) {
                                return response.data;});
                    L.geoJSON(
                            data,

                            {style: {color: 'green'}}).addTo(map);

                })
            }
        getLocation();
        });





    </script>


</head>

<body ng-app="SearchAndRouteModule" ng-controller="SearchAndRouteController">
<div class="container-fluid">
<div class="col-xs-4">
<input type="text" ng-model="asyncSelected" placeholder="Search biketrails" typeahead="address[0]+address[1] for address in getLocation($viewValue)" typeahead-on-select="onSelect($item,$model,$label)" class="form-control">
</div>
<div class="col-xs-6">
<div ng-repeat="address in Selected">
    <div class="row">
    <div ng-bind="fromToArray[$index]"></div>
    <div ng-bind="address[0]+address[1]"></div>

    </div>
    <div ng-click="rearrange()" class="glyphicon glyphicon-sort"></div>
</div>
    </div>
    <leaflet></leaflet>
</div>
</body>
</html>